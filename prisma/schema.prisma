generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider     = "mysql"
  url          = env("DATABASE_URL")
  relationMode = "prisma"
}

model admin_users {
  id                 Int              @id @default(autoincrement())
  email              String           @unique @db.VarChar(255)
  password           String           @db.VarChar(255)
  name               String           @db.VarChar(255)
  role               admin_users_role @default(SALES)
  isActive           Boolean          @default(true)
  createdAt          DateTime         @default(now())
  updatedAt          DateTime
  lastLogin          DateTime?
  avatar             String?          @db.VarChar(500)
  canApproveInvoices Boolean          @default(false)
  canCreateInvoices  Boolean          @default(true)
  canCreateLeads     Boolean          @default(true)
  canDeleteLeads     Boolean          @default(false)
  canEditLeads       Boolean          @default(true)
  canViewAllLeads    Boolean          @default(false)
  department         String?          @db.VarChar(100)
  designation        String?          @db.VarChar(100)
  managerId          Int?
  monthlyTarget      Decimal?         @db.Decimal(12, 2)
  phone              String?          @db.VarChar(50)
  quarterlyTarget    Decimal?         @db.Decimal(12, 2)

  @@index([email])
  @@index([isActive])
  @@index([managerId])
  @@index([role])
}

model company_settings {
  id                     Int      @id @default(autoincrement())
  companyName            String   @db.VarChar(255)
  companyAddress         String?  @db.Text
  companyCity            String?  @db.VarChar(100)
  companyState           String?  @db.VarChar(100)
  companyPincode         String?  @db.VarChar(20)
  companyCountry         String?  @default("India") @db.VarChar(100)
  companyPhone           String?  @db.VarChar(50)
  companyEmail           String?  @db.VarChar(255)
  companyWebsite         String?  @db.VarChar(255)
  companyGstNumber       String?  @db.VarChar(50)
  companyPanNumber       String?  @db.VarChar(50)
  logoUrl                String?  @db.VarChar(500)
  defaultCurrency        String   @default("INR") @db.VarChar(10)
  defaultPaymentTerms    String?  @db.VarChar(255)
  defaultCreditDays      Int?     @default(0)
  defaultTermsConditions String?  @db.Text
  bankName               String?  @db.VarChar(255)
  bankAccountNumber      String?  @db.VarChar(50)
  bankIfscCode           String?  @db.VarChar(20)
  bankBranch             String?  @db.VarChar(255)
  invoicePrefix          String?  @default("INV") @db.VarChar(20)
  quotePrefix            String?  @default("QT") @db.VarChar(20)
  proformaPrefix         String?  @default("PI") @db.VarChar(20)
  nextInvoiceNumber      Int?     @default(1)
  nextQuoteNumber        Int?     @default(1)
  createdAt              DateTime @default(now())
  updatedAt              DateTime
}

model currencies {
  id            Int      @id @default(autoincrement())
  code          String   @unique @db.VarChar(10)
  name          String   @db.VarChar(100)
  symbol        String   @db.VarChar(10)
  symbolNative  String   @db.VarChar(10)
  decimalDigits Int      @default(2)
  isDefault     Boolean  @default(false)
  isActive      Boolean  @default(true)
  createdAt     DateTime @default(now())
  updatedAt     DateTime

  @@index([code])
  @@index([isDefault])
}

model customer_contacts {
  id          Int      @id @default(autoincrement())
  customerId  Int
  name        String   @db.VarChar(255)
  email       String?  @db.VarChar(255)
  phone       String?  @db.VarChar(50)
  designation String?  @db.VarChar(100)
  department  String?  @db.VarChar(100)
  isPrimary   Boolean  @default(false)
  isBilling   Boolean  @default(true)
  isShipping  Boolean  @default(true)
  isActive    Boolean  @default(true)
  notes       String?  @db.Text
  createdAt   DateTime @default(now())
  updatedAt   DateTime
}

model opportunity_products {
  id            Int     @id @default(autoincrement())
  opportunityId Int
  productId     Int
  quantity      Decimal @db.Decimal(10, 2)
  unitPrice     Decimal @db.Decimal(10, 2)
  discount      Decimal @default(0.00) @db.Decimal(10, 2)
}

model organization_members {
  id             Int      @id @default(autoincrement())
  organizationId Int
  clerkUserId    String   @db.VarChar(255)
  role           String   @default("MEMBER") @db.VarChar(50)
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime

  @@index([clerkUserId])
  @@index([organizationId])
}

model page_views {
  id        Int      @id @default(autoincrement())
  path      String   @db.VarChar(500)
  title     String?  @db.VarChar(255)
  ipAddress String?  @db.VarChar(100)
  userAgent String?  @db.Text
  referrer  String?  @db.VarChar(500)
  viewedAt  DateTime @default(now())

  @@index([path])
  @@index([viewedAt])
}

model payment_terms {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  days        Int      @default(0)
  description String?  @db.VarChar(255)
  isDefault   Boolean  @default(false)
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([isActive])
}

model quote_requests {
  id             Int                   @id @default(autoincrement())
  name           String                @db.VarChar(255)
  email          String                @db.VarChar(255)
  phone          String?               @db.VarChar(50)
  company        String?               @db.VarChar(255)
  productName    String?               @db.VarChar(255)
  quantity       Int?
  specifications String?               @db.Text
  estimatedValue Decimal?              @db.Decimal(10, 2)
  currency       String?               @default("INR") @db.VarChar(10)
  status         quote_requests_status @default(PENDING)
  assignedTo     String?               @db.VarChar(255)
  notes          String?               @db.Text
  createdAt      DateTime              @default(now())
  updatedAt      DateTime
  organizationId Int?

  @@index([createdAt])
  @@index([email])
  @@index([status])
}

model units_of_measure {
  id          Int      @id @default(autoincrement())
  code        String   @unique @db.VarChar(20)
  name        String   @db.VarChar(100)
  description String?  @db.VarChar(255)
  isActive    Boolean  @default(true)
  sortOrder   Int      @default(0)
  createdAt   DateTime @default(now())
  updatedAt   DateTime

  @@index([code])
  @@index([isActive])
}

enum admin_users_role {
  SUPER_ADMIN
  ADMIN
  SALES_MANAGER
  SALES
  MARKETING
  SUPPORT
  FINANCE
  VIEWER
}

enum quote_requests_status {
  PENDING
  IN_PROGRESS
  SENT
  ACCEPTED
  DECLINED
}

// ============================================
// NEW ERP TABLES - Added from NexPOS
// ============================================

// Vendors (Suppliers)
model vendors {
  id             Int      @id @default(autoincrement())
  code           String?  @unique @db.VarChar(50)
  name           String   @db.VarChar(255)
  displayName    String?  @db.VarChar(255)
  email          String?  @db.VarChar(255)
  phone          String?  @db.VarChar(50)
  website        String?  @db.VarChar(255)
  contactPerson  String?  @db.VarChar(255)
  contactPhone   String?  @db.VarChar(50)
  contactEmail   String?  @db.VarChar(255)
  address        String?  @db.Text
  city           String?  @db.VarChar(100)
  state          String?  @db.VarChar(100)
  pincode        String?  @db.VarChar(20)
  country        String?  @default("India") @db.VarChar(100)
  gstNumber      String?  @db.VarChar(50)
  gstType        GstType? @default(UNREGISTERED)
  panNumber      String?  @db.VarChar(50)
  paymentTerms   String?  @db.VarChar(100)
  creditLimit    Decimal? @db.Decimal(12, 2)
  creditDays     Int?     @default(0)
  openingBalance Decimal? @default(0.00) @db.Decimal(12, 2)
  currentBalance Decimal? @default(0.00) @db.Decimal(12, 2)
  notes          String?  @db.Text
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  purchaseOrders purchase_orders[]
  expenses       expenses[]

  @@index([name])
  @@index([isActive])
}

// Products / Inventory Items
model products {
  id               Int      @id @default(autoincrement())
  sku              String   @unique @db.VarChar(100)
  name             String   @db.VarChar(255)
  description      String?  @db.Text
  categoryId       Int?
  hsnCode          String?  @db.VarChar(20)
  unit             String   @default("PCS") @db.VarChar(20)
  basePrice        Decimal  @db.Decimal(10, 2)
  costPrice        Decimal? @db.Decimal(10, 2)
  mrp              Decimal? @db.Decimal(10, 2)
  gstRate          Decimal  @default(18.00) @db.Decimal(5, 2)
  currency         String   @default("INR") @db.VarChar(10)
  stockQuantity    Int      @default(0)
  reorderLevel     Int?     @default(0)
  isActive         Boolean  @default(true)
  isTaxable        Boolean  @default(true)
  imageUrl         String?  @db.VarChar(500)
  createdAt        DateTime @default(now())
  updatedAt        DateTime @updatedAt

  category              categories?             @relation(fields: [categoryId], references: [id])
  purchaseOrderItems    purchase_order_items[]
  grnItems              grn_items[]
  inventoryRecords      inventory[]
  inventoryBatches      inventory_batches[]
  stockMovements        stock_movements[]
  salesOrderItems       sales_order_items[]
  quotationItems        quotation_items[]
  invoiceItems          invoice_items[]

  @@index([sku])
  @@index([name])
  @@index([categoryId])
  @@index([isActive])
}

// Product Categories
model categories {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  slug        String   @unique @db.VarChar(100)
  description String?  @db.Text
  parentId    Int?
  imageUrl    String?  @db.VarChar(500)
  sortOrder   Int      @default(0)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   categories?  @relation("CategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children categories[] @relation("CategoryHierarchy")
  products products[]

  @@index([parentId])
  @@index([isActive])
}

// Customers
model customers {
  id             Int      @id @default(autoincrement())
  customerCode   String?  @unique @db.VarChar(50)
  name           String   @db.VarChar(255)
  displayName    String?  @db.VarChar(255)
  email          String?  @db.VarChar(255)
  phone          String?  @db.VarChar(50)
  website        String?  @db.VarChar(255)
  contactPerson  String?  @db.VarChar(255)
  contactPhone   String?  @db.VarChar(50)
  contactEmail   String?  @db.VarChar(255)
  address        String?  @db.Text
  city           String?  @db.VarChar(100)
  state          String?  @db.VarChar(100)
  pincode        String?  @db.VarChar(20)
  country        String?  @default("India") @db.VarChar(100)
  gstNumber      String?  @db.VarChar(50)
  gstType        GstType? @default(UNREGISTERED)
  panNumber      String?  @db.VarChar(50)
  paymentTerms   String?  @db.VarChar(100)
  creditLimit    Decimal? @db.Decimal(12, 2)
  creditDays     Int?     @default(0)
  openingBalance Decimal? @default(0.00) @db.Decimal(12, 2)
  currentBalance Decimal? @default(0.00) @db.Decimal(12, 2)
  notes          String?  @db.Text
  isActive       Boolean  @default(true)
  createdAt      DateTime @default(now())
  updatedAt      DateTime @updatedAt

  quotations  quotations[]
  salesOrders sales_orders[]
  invoices    invoices[]

  @@index([name])
  @@index([email])
  @@index([isActive])
}

// Locations / Warehouses
model locations {
  id          Int      @id @default(autoincrement())
  code        String   @unique @db.VarChar(50)
  name        String   @db.VarChar(255)
  type        String   @default("WAREHOUSE") @db.VarChar(50)
  address     String?  @db.Text
  city        String?  @db.VarChar(100)
  state       String?  @db.VarChar(100)
  pincode     String?  @db.VarChar(20)
  country     String?  @default("India") @db.VarChar(100)
  phone       String?  @db.VarChar(50)
  email       String?  @db.VarChar(255)
  managerId   Int?
  isDefault   Boolean  @default(false)
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  purchaseOrders   purchase_orders[]
  goodsReceiptNotes goods_receipt_notes[]
  inventoryRecords inventory[]
  inventoryBatches inventory_batches[]
  stockMovements   stock_movements[]

  @@index([code])
  @@index([isActive])
}

// Purchase Orders
model purchase_orders {
  id            Int                   @id @default(autoincrement())
  poNumber      String                @unique @db.VarChar(50)
  vendorId      Int
  locationId    Int
  vendorName    String                @db.VarChar(255)
  vendorEmail   String?               @db.VarChar(255)
  vendorGst     String?               @db.VarChar(50)
  vendorState   String?               @db.VarChar(100)
  subtotal      Decimal               @db.Decimal(12, 2)
  taxAmount     Decimal               @default(0.00) @db.Decimal(12, 2)
  shippingCost  Decimal               @default(0.00) @db.Decimal(10, 2)
  discount      Decimal               @default(0.00) @db.Decimal(10, 2)
  total         Decimal               @db.Decimal(12, 2)
  currency      String                @default("INR") @db.VarChar(10)
  status        PurchaseOrderStatus   @default(DRAFT)
  paymentStatus PaymentStatus         @default(UNPAID)
  orderDate     DateTime              @default(now())
  expectedDate  DateTime?
  receivedDate  DateTime?
  paymentTerms  String?               @db.VarChar(255)
  notes         String?               @db.Text
  internalNotes String?               @db.Text
  createdBy     Int?
  createdAt     DateTime              @default(now())
  updatedAt     DateTime              @updatedAt

  vendor            vendors               @relation(fields: [vendorId], references: [id])
  location          locations             @relation(fields: [locationId], references: [id])
  items             purchase_order_items[]
  goodsReceiptNotes goods_receipt_notes[]

  @@index([vendorId])
  @@index([locationId])
  @@index([status])
  @@index([orderDate])
}

model purchase_order_items {
  id               Int     @id @default(autoincrement())
  purchaseOrderId  Int
  productId        Int
  productName      String  @db.VarChar(255)
  productSku       String  @db.VarChar(100)
  orderedQuantity  Int
  receivedQuantity Int     @default(0)
  unitCost         Decimal @db.Decimal(10, 2)
  taxRate          Decimal @default(0.00) @db.Decimal(5, 2)
  totalCost        Decimal @db.Decimal(12, 2)
  createdAt        DateTime @default(now())

  purchaseOrder purchase_orders @relation(fields: [purchaseOrderId], references: [id], onDelete: Cascade)
  product       products        @relation(fields: [productId], references: [id])

  @@index([purchaseOrderId])
  @@index([productId])
}

// Goods Receipt Notes (GRN)
model goods_receipt_notes {
  id              Int       @id @default(autoincrement())
  grnNumber       String    @unique @db.VarChar(50)
  purchaseOrderId Int
  locationId      Int
  vendorName      String    @db.VarChar(255)
  receivedDate    DateTime  @default(now())
  status          GrnStatus @default(PENDING)
  notes           String?   @db.Text
  receivedBy      Int?
  verifiedBy      Int?
  verifiedAt      DateTime?
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  purchaseOrder purchase_orders @relation(fields: [purchaseOrderId], references: [id])
  location      locations       @relation(fields: [locationId], references: [id])
  items         grn_items[]

  @@index([purchaseOrderId])
  @@index([locationId])
  @@index([status])
}

model grn_items {
  id              Int      @id @default(autoincrement())
  grnId           Int
  productId       Int
  productName     String   @db.VarChar(255)
  productSku      String   @db.VarChar(100)
  orderedQuantity Int
  receivedQuantity Int
  acceptedQuantity Int     @default(0)
  rejectedQuantity Int     @default(0)
  batchNumber     String?  @db.VarChar(100)
  expiryDate      DateTime?
  unitCost        Decimal  @db.Decimal(10, 2)
  notes           String?  @db.Text
  createdAt       DateTime @default(now())

  grn     goods_receipt_notes @relation(fields: [grnId], references: [id], onDelete: Cascade)
  product products            @relation(fields: [productId], references: [id])

  @@index([grnId])
  @@index([productId])
}

// Quotations
model quotations {
  id            Int             @id @default(autoincrement())
  quoteNumber   String          @unique @db.VarChar(50)
  customerId    Int
  customerName  String          @db.VarChar(255)
  customerEmail String?         @db.VarChar(255)
  customerGst   String?         @db.VarChar(50)
  customerState String?         @db.VarChar(100)
  quoteDate     DateTime        @default(now())
  validUntil    DateTime?
  subtotal      Decimal         @db.Decimal(12, 2)
  taxAmount     Decimal         @default(0.00) @db.Decimal(12, 2)
  discount      Decimal         @default(0.00) @db.Decimal(10, 2)
  total         Decimal         @db.Decimal(12, 2)
  currency      String          @default("INR") @db.VarChar(10)
  status        QuotationStatus @default(DRAFT)
  terms         String?         @db.Text
  notes         String?         @db.Text
  createdBy     Int?
  createdAt     DateTime        @default(now())
  updatedAt     DateTime        @updatedAt

  customer customers         @relation(fields: [customerId], references: [id])
  items    quotation_items[]

  @@index([customerId])
  @@index([status])
  @@index([quoteDate])
}

model quotation_items {
  id          Int     @id @default(autoincrement())
  quotationId Int
  productId   Int
  productName String  @db.VarChar(255)
  productSku  String  @db.VarChar(100)
  description String? @db.Text
  quantity    Int
  unitPrice   Decimal @db.Decimal(10, 2)
  taxRate     Decimal @default(0.00) @db.Decimal(5, 2)
  discount    Decimal @default(0.00) @db.Decimal(10, 2)
  total       Decimal @db.Decimal(12, 2)
  createdAt   DateTime @default(now())

  quotation quotations @relation(fields: [quotationId], references: [id], onDelete: Cascade)
  product   products   @relation(fields: [productId], references: [id])

  @@index([quotationId])
  @@index([productId])
}

// Sales Orders
model sales_orders {
  id              Int               @id @default(autoincrement())
  soNumber        String            @unique @db.VarChar(50)
  customerId      Int
  customerName    String            @db.VarChar(255)
  customerEmail   String?           @db.VarChar(255)
  customerGst     String?           @db.VarChar(50)
  customerState   String?           @db.VarChar(100)
  customerPoNumber String?          @db.VarChar(100)
  orderDate       DateTime          @default(now())
  deliveryDate    DateTime?
  subtotal        Decimal           @db.Decimal(12, 2)
  taxAmount       Decimal           @default(0.00) @db.Decimal(12, 2)
  discount        Decimal           @default(0.00) @db.Decimal(10, 2)
  total           Decimal           @db.Decimal(12, 2)
  currency        String            @default("INR") @db.VarChar(10)
  status          SalesOrderStatus  @default(PENDING)
  paymentStatus   PaymentStatus     @default(UNPAID)
  terms           String?           @db.Text
  notes           String?           @db.Text
  createdBy       Int?
  createdAt       DateTime          @default(now())
  updatedAt       DateTime          @updatedAt

  customer customers           @relation(fields: [customerId], references: [id])
  items    sales_order_items[]

  @@index([customerId])
  @@index([status])
  @@index([orderDate])
}

model sales_order_items {
  id              Int     @id @default(autoincrement())
  salesOrderId    Int
  productId       Int
  productName     String  @db.VarChar(255)
  productSku      String  @db.VarChar(100)
  quantity        Int
  deliveredQty    Int     @default(0)
  unitPrice       Decimal @db.Decimal(10, 2)
  taxRate         Decimal @default(0.00) @db.Decimal(5, 2)
  discount        Decimal @default(0.00) @db.Decimal(10, 2)
  total           Decimal @db.Decimal(12, 2)
  createdAt       DateTime @default(now())

  salesOrder sales_orders @relation(fields: [salesOrderId], references: [id], onDelete: Cascade)
  product    products     @relation(fields: [productId], references: [id])

  @@index([salesOrderId])
  @@index([productId])
}

// Invoices
model invoices {
  id             Int           @id @default(autoincrement())
  invoiceNumber  String        @unique @db.VarChar(50)
  customerId     Int
  customerName   String        @db.VarChar(255)
  customerEmail  String?       @db.VarChar(255)
  customerGst    String?       @db.VarChar(50)
  customerState  String?       @db.VarChar(100)
  invoiceDate    DateTime      @default(now())
  dueDate        DateTime?
  subtotal       Decimal       @db.Decimal(12, 2)
  cgst           Decimal       @default(0.00) @db.Decimal(12, 2)
  sgst           Decimal       @default(0.00) @db.Decimal(12, 2)
  igst           Decimal       @default(0.00) @db.Decimal(12, 2)
  taxAmount      Decimal       @default(0.00) @db.Decimal(12, 2)
  discount       Decimal       @default(0.00) @db.Decimal(10, 2)
  total          Decimal       @db.Decimal(12, 2)
  amountPaid     Decimal       @default(0.00) @db.Decimal(12, 2)
  balanceDue     Decimal       @db.Decimal(12, 2)
  currency       String        @default("INR") @db.VarChar(10)
  status         InvoiceStatus @default(DRAFT)
  paymentStatus  PaymentStatus @default(UNPAID)
  terms          String?       @db.Text
  notes          String?       @db.Text
  createdBy      Int?
  createdAt      DateTime      @default(now())
  updatedAt      DateTime      @updatedAt

  customer customers       @relation(fields: [customerId], references: [id])
  items    invoice_items[]

  @@index([customerId])
  @@index([status])
  @@index([invoiceDate])
}

model invoice_items {
  id          Int     @id @default(autoincrement())
  invoiceId   Int
  productId   Int
  productName String  @db.VarChar(255)
  productSku  String  @db.VarChar(100)
  hsnCode     String? @db.VarChar(20)
  quantity    Int
  unitPrice   Decimal @db.Decimal(10, 2)
  taxRate     Decimal @default(0.00) @db.Decimal(5, 2)
  cgst        Decimal @default(0.00) @db.Decimal(10, 2)
  sgst        Decimal @default(0.00) @db.Decimal(10, 2)
  igst        Decimal @default(0.00) @db.Decimal(10, 2)
  discount    Decimal @default(0.00) @db.Decimal(10, 2)
  total       Decimal @db.Decimal(12, 2)
  createdAt   DateTime @default(now())

  invoice invoices @relation(fields: [invoiceId], references: [id], onDelete: Cascade)
  product products @relation(fields: [productId], references: [id])

  @@index([invoiceId])
  @@index([productId])
}

// Inventory (Stock per location)
model inventory {
  id               Int       @id @default(autoincrement())
  locationId       Int
  productId        Int
  quantity         Int       @default(0)
  reservedQuantity Int       @default(0)
  lastStockUpdate  DateTime?
  updatedAt        DateTime  @updatedAt

  location locations @relation(fields: [locationId], references: [id], onDelete: Cascade)
  product  products  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([locationId, productId])
  @@index([locationId])
  @@index([productId])
}

// Inventory Batches
model inventory_batches {
  id              Int       @id @default(autoincrement())
  locationId      Int
  productId       Int
  batchNumber     String    @db.VarChar(100)
  expiryDate      DateTime?
  manufactureDate DateTime?
  quantity        Int       @default(0)
  costPrice       Decimal?  @db.Decimal(10, 2)
  mrp             Decimal?  @db.Decimal(10, 2)
  receivedDate    DateTime  @default(now())
  isExpired       Boolean   @default(false)
  nearExpiry      Boolean   @default(false)
  createdAt       DateTime  @default(now())
  updatedAt       DateTime  @updatedAt

  location locations @relation(fields: [locationId], references: [id], onDelete: Cascade)
  product  products  @relation(fields: [productId], references: [id], onDelete: Cascade)

  @@unique([locationId, productId, batchNumber])
  @@index([locationId])
  @@index([productId])
  @@index([expiryDate])
}

// Stock Movements
model stock_movements {
  id            Int               @id @default(autoincrement())
  locationId    Int
  productId     Int
  movementType  StockMovementType
  quantity      Int
  previousQty   Int               @default(0)
  newQty        Int               @default(0)
  referenceType String?           @db.VarChar(50)
  referenceId   Int?
  batchNumber   String?           @db.VarChar(100)
  reason        String?           @db.VarChar(255)
  notes         String?           @db.Text
  createdBy     Int?
  createdAt     DateTime          @default(now())

  location locations @relation(fields: [locationId], references: [id])
  product  products  @relation(fields: [productId], references: [id])

  @@index([locationId])
  @@index([productId])
  @@index([movementType])
  @@index([createdAt])
}

// Expense Categories
model expense_categories {
  id          Int      @id @default(autoincrement())
  name        String   @db.VarChar(100)
  description String?  @db.Text
  parentId    Int?
  isActive    Boolean  @default(true)
  createdAt   DateTime @default(now())
  updatedAt   DateTime @updatedAt

  parent   expense_categories?  @relation("ExpenseCategoryHierarchy", fields: [parentId], references: [id], onDelete: NoAction, onUpdate: NoAction)
  children expense_categories[] @relation("ExpenseCategoryHierarchy")
  expenses expenses[]

  @@index([parentId])
  @@index([isActive])
}

// Expenses
model expenses {
  id          Int           @id @default(autoincrement())
  categoryId  Int?
  vendorId    Int?
  description String        @db.VarChar(255)
  amount      Decimal       @db.Decimal(12, 2)
  taxAmount   Decimal       @default(0.00) @db.Decimal(10, 2)
  total       Decimal       @db.Decimal(12, 2)
  currency    String        @default("INR") @db.VarChar(10)
  expenseDate DateTime      @default(now())
  status      ExpenseStatus @default(PENDING)
  paymentMode String?       @db.VarChar(50)
  reference   String?       @db.VarChar(100)
  notes       String?       @db.Text
  receiptUrl  String?       @db.VarChar(500)
  createdBy   Int?
  approvedBy  Int?
  approvedAt  DateTime?
  createdAt   DateTime      @default(now())
  updatedAt   DateTime      @updatedAt

  category expense_categories? @relation(fields: [categoryId], references: [id])
  vendor   vendors?            @relation(fields: [vendorId], references: [id])

  @@index([categoryId])
  @@index([vendorId])
  @@index([status])
  @@index([expenseDate])
}

// ============================================
// NEW ENUMS
// ============================================

enum GstType {
  REGISTERED
  UNREGISTERED
  COMPOSITION
  SEZ
  EXPORT
}

enum PurchaseOrderStatus {
  DRAFT
  SENT
  CONFIRMED
  PARTIAL_RECEIVED
  RECEIVED
  CANCELLED
}

enum GrnStatus {
  PENDING
  QC_PENDING
  QC_PASSED
  QC_FAILED
  COMPLETED
}

enum QuotationStatus {
  DRAFT
  SENT
  VIEWED
  ACCEPTED
  REJECTED
  EXPIRED
  CONVERTED
}

enum SalesOrderStatus {
  PENDING
  CONFIRMED
  IN_PROGRESS
  COMPLETED
  CANCELLED
  ON_HOLD
}

enum InvoiceStatus {
  DRAFT
  SENT
  VIEWED
  PAID
  OVERDUE
  CANCELLED
  REFUNDED
}

enum PaymentStatus {
  UNPAID
  PARTIAL
  PAID
  OVERDUE
  REFUNDED
}

enum StockMovementType {
  IN
  OUT
  ADJUSTMENT
  TRANSFER
  RETURN
  DAMAGE
}

enum ExpenseStatus {
  PENDING
  APPROVED
  REJECTED
  PAID
}
